---
title: "ESM 204 - Homework 2"
author: "Kirsten White, Van Gonzales, Max Settineri"
date: "4/22/2022"
output: html_document
---

```{r setup, message = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(equatiomatic)
```
# Overview

The dataset contains estimates of the marginal cost of reducing water usage in each of the four irrigation districts (Kern, Mojave, Antelope, and Ventura) at different levels of reduction (in Acre Feet).

Baseline water usage by district is provided: 

- Kern = 150 AF
- Mojave = 140 AF
- Antelope = 220 AF 
- Ventura = 245 AF

Prices are in $/Acre Foot and quantities are in Acre Feet (AF).

```{r}
# Read in the data
water_data <- read_csv(here("Water_Districts.csv")) %>%
  clean_names

# Re-organize the data
mc_data <- pivot_longer(data = water_data, 
                        cols = mc_kern:mc_ventura, 
                        names_to = "district", 
                        values_to = "mc") 

```

# PART 1 - Marginal Abatement Cost Curves for each Irrigation District

For each irrigation district, plot the marginal abatement cost data (from the data provided) and estimate a linear regression model with zero intercept. These estimated linear regressions will be your estimates of the marginal abatement cost curve (one for each irrigation district), which you will use for the remainder of this analysis.

### Figure 1: This graph shows MC curves for each district

```{r}
# Plot the data for each irrigation district

# All together
ggplot(data = mc_data, aes(x = reduction, y = mc))+
  geom_jitter(size = 0.5, aes(color = district))+
  theme_grey()+ 
  geom_smooth(method = "lm", aes(color = district))+
  labs(x = "Abatement (Acre Feet, AF)", 
       y = "Price of Water Reduction ($/AF)", 
       title = "Marginal Cost Curves")+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```



```{r}
# Linear models for each district with the y-intercept as zero

lm_kern <- lm(mc_kern ~ 0 + reduction, data = water_data)
lm_mojave <- lm(mc_mojave ~ 0 + reduction, data = water_data)
lm_antelope <- lm(mc_antelope ~ 0 + reduction, data = water_data)
lm_ventura <- lm(mc_ventura ~ 0 + reduction, data = water_data)

# Find slopes for each district

slope_kern <- lm_kern$coefficient[1]
slope_mojave <- lm_mojave$coefficient[1]
slope_antelope <- lm_antelope$coefficient[1]
slope_ventura <- lm_ventura$coefficient[1]
```

# PART 2 - Water Demand Curves for each Irrigation District 

Using your estimated marginal abatement cost curves, derive each district’s demand curve for water. In other words, how much would each district be willing to pay for the right to use the first AF of water, second AF, etc.? Plot each district’s demand curve on a single graph.
Which sector is willing to pay the most for the first AF of water?

### Figure 2: This graph shows water demand for each district  

```{r}
# Derive District's Demand Curves for Water

# Abatement = Eo - E

# Eo provided as the baseline usage for each district

kern_baseline <- 150
mojave_baseline <- 140
antelope_baseline <- 220
ventura_baseline <- 245

# Derive each demand curve by substituting it on the previous marginal cost curves

# If Abatement = Eo - E; 

kern_mb <- function(x){343.5 - 2.29*x}
mojave_mb <- function(x){532.0 - 3.8*x}
antelope_mb <- function(x){629.2 - 2.86*x}
ventura_mb <- function(x){436.1 - 1.78*x}


# Plot Demand Curves

ggplot(data.frame(x = c(0, 250)), aes(x = x)) + 
  stat_function(fun = kern_mb, color = "green") +
  stat_function(fun = mojave_mb, color = "cyan") +
  stat_function(fun = antelope_mb, color = "pink") +
  stat_function(fun = ventura_mb, color = "purple") +
  theme_minimal() +
  ylim(0, 750) +
  labs(x = "Amount of Water Used (AF)", y = "Price of Water Reduction ($/AF)",
       title = "Demand for Water") 
```

Based off of the graph above, Antelope is willing to pay the most for the first unit of abatement. 

# PART 3 - Policy Considerations
- Here you will analyze three alternative policies for reducing water use among these irrigation districts.
- In total, these irrigation districts will need to reduce water consumption from the current 755 AF down to 500 AF. For each intervention listed below, perform the following calculations: (1) calculate the stringency of the policy (defined below for each intervention) required to achieve the 500 AF target, (2) calculate the total cost of meeting the target using that approach, (3) calculate the cost to each district, and (4) calculate the tax revenue generated.

### Policy A - Cap Without Trade 
Reduce each district’s water use by the same fraction (e.g., 1/3 of current baseline use), so the 500 AF target is met. Trade is not allowed. Stringency is defined as the magnitude of the fraction.


```{r}
# Stringency is the fraction by which each district has to reduce its water usage (the amount each district has to reduce will total to 500 AF)
a_stringency <- (255/755)

# Amount each district needs to abate to reach goal 
kern_use_reduction <- (a_stringency * kern_baseline)
# kern has to reduce 50.7

mojave_use_reduction  <- (a_stringency * mojave_baseline)
# mojave has to reduce 47.9

antelope_use_reduction  <- (a_stringency * antelope_baseline)
# antelope has to reduce 74.3

ventura_use_reduction  <- (a_stringency * ventura_baseline)
# ventura has to reduce 82.7

# Now we can find the new abatement values by subtracting each districts baseline water use from the amount they need to reduce by 

kern_abatement <- kern_baseline - kern_use_reduction
# kern needs to abate 50.7 units from baseline 150 = 99.3
mojave_abatement <- mojave_baseline - mojave_use_reduction
# mojave needs to abate 47.32 units from baseline 140 = 92.7
antelope_abatement <- antelope_baseline - antelope_use_reduction
# antelope needs to abate 74.36 units from baseline 220 = 145.6
ventura_abatement <- ventura_baseline - ventura_use_reduction
# ventura needs to abate 82.81 units from baseline 245 = 162.3 

# With the new quantity of water each district is allowed to use, we can find the price at this new abatement level 

# Then, to find the total cost to each district, we can plug in the reduction (new abatement quantity) into each district's cost curve (equation of the MC curve) and find the area under the line (area of a triangle)

kern_price_abatement <- (343.5-2.29*(kern_abatement))
kern_cost_abatement <- (0.5 * kern_use_reduction * kern_price_abatement)
# y (P* ) = 343.5 - 2.29 (99.3) =  115.20; 
# therefore the total cost to abate is the area under the curve = (1/2 * 50.7 * 115.20) = $2,938.83
# kern total cost = $2,938.83

mojave_price_abatement <- (532.0 - 3.8*(mojave_abatement))
mojave_cost_abatement <- (0.5 * mojave_use_reduction * mojave_price_abatement)
# y (P* ) = 532.0 - 3.8* (92.68) = 179.82, 
# mojave total cost = (0.5 * 179.82*47.32) = $4,248.11

antelope_price_abatement <- (629.2 - 2.86*(antelope_abatement))
antelope_cost_abatement <- (0.5 * antelope_use_reduction * antelope_price_abatement)
#y (P* ) = 629.2 - 2.86* (145.64) = 212.70; 
# antelope total cost = (0.5 * 212.70 * 74.26) = $7,895.29

ventura_price_abatement <- (436.1 - 1.78*(ventura_abatement))
ventura_cost_abatement <- (0.5 * ventura_use_reduction * ventura_price_abatement)
# y (P* ) = 436.1 - 1.78* (162.192) = 147, P 
# ventura total cost = (0.5 * 147 * 82.82) = $6,094.09

total_cost_abate <- kern_cost_abatement + mojave_cost_abatement + antelope_cost_abatement + ventura_cost_abatement
# the total cost of abatement for all the districts under this policy is $21,176.32
```
- Each district has to reduce `r round(a_stringency, 3)`% from their starting baseline to reach the abatement target of 500 AF.  

- The total cost to each district under this policy is: 

  - Kern: $`r round(kern_cost_abatement, 0)`

  - Mojave: $`r round(mojave_cost_abatement, 0)`

  - Antelope: $`r round(antelope_cost_abatement, 0)`

  - Ventura: $`r round(ventura_cost_abatement, 0)`

- The overall total cost is: 
  - $`r total_cost_abate`

    

### Policy B - Tax on Water Usage
A single tax is implemented on all water use in each of the four districts, such that water use is reduced to the 500 AF target. Stringency is defined as the magnitude of the tax.

- To evaluate the tax needed to achieve a use target of 500 AF, we must compute the aggregate marginal cost curve and calculate the correspondent $/AF for that reduction (255 AF).
```{r}
# step 1: Find the MC Aggregate demand by adding up the inverse slopes of each district's marginal cost curve

mc_aggregate_slope <- (1/slope_kern + 1/slope_mojave + 1/slope_antelope + 1/slope_ventura)
# MC Aggregate = 1.61Q

# step 2: find the tax at the target abatement level of 255

tax_target <- 255/mc_aggregate_slope
# tax is $158.07

# step 3: find the amount of water usage each district needs to reduce by at this tax level (by plugging in the tax and solving for the new abatement quantity) 


```


Step 1: Find the MC Aggregate 

- MC Aggregate(Q) = 1.61(P)

Step 2: Find the tax


### Policy C - Cap and Trade
Cap water use as in part (a), but after those caps are set, allow trade across districts. How much water is used by each district after trade? Stringency is the same as in part (a).

